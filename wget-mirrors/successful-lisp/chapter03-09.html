<html><head>
<title>Successful Lisp - Chapter 3, Lesson 9</title> 
</head> 

<body>
<h1>Chapter 3 - Essential Lisp in Twelve Lessons</h1> 

<h2><A NAME="lesson-9">Lesson 9 - Essential Multiple Values</A></h2> 

<h3>Most forms create only one value</h3> 

<P>A form typically returns only one value.  Lisp has only a small number of 
forms which create or receive multiple values.</P>

<h3>VALUES creates multiple (or no) values</h3> 

<P>The <CODE>VALUES</CODE> form creates zero or more values:</P>

<PRE WIDTH=80><IMG SRC="gifs/circle-dot.gif" ALT="?" ALIGN="BOTTOM"> (values)

<IMG SRC="gifs/circle-dot.gif" ALT="?" ALIGN="BOTTOM"> (values :this)
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> :THIS

<IMG SRC="gifs/circle-dot.gif" ALT="?" ALIGN="BOTTOM"> (values :this :that)
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> :THIS
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> :THAT</PRE>

<P>We show how many values are returned by the number of <IMG 
SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> lines produced 
by the evaluation of the form.  The three <CODE>VALUES</CODE> forms in the 
example above produced zero, one, and two values, respectively.</P>

<P><CODE>VALUES</CODE> is a function, and so evaluates its arguments.</P>

<h3>A few special forms receive multiple values</h3> 

<P>What might you want to do with multiple values in a program?  The most 
basic operations are to:</P>

<OL>
<LI>bind each value to a separate symbol, or</LI>
<LI>collect the values into a list.</LI>
</OL>

<P>Use <CODE>MULTIPLE-VALUE-BIND</CODE> to bind each value to a separate 
symbol:</P>

<PRE WIDTH=80><IMG SRC="gifs/circle-dot.gif" ALT="?" ALIGN="BOTTOM"> (multiple-value-bind (a b c) (values 2 3 5)
     (+ a b c))
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> 13</PRE>

<P>If you provide more values than symbols, the excess values are ignored:</P>

<PRE WIDTH=80><IMG SRC="gifs/circle-dot.gif" ALT="?" ALIGN="BOTTOM"> (multiple-value-bind (a b c) (values 2 3 5 'x 'y)
     (+ a b c))
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> 13</PRE>

<P>If you provide fewer values than symbols, the excess symbols are bound 
to <CODE>NIL</CODE>:</P>

<PRE WIDTH=80><IMG SRC="gifs/circle-dot.gif" ALT="?" ALIGN="BOTTOM"> (multiple-value-bind (w x y z) (values :left :right)
     (list w x y z))
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> (:LEFT :RIGHT NIL NIL)</PRE>

<h3>Most forms pass along multiple values</h3> 

<P><EM>NOTE:</EM> MOST <EM>IS TOO STRONG -- CHANGE TO</EM> SOME <EM>HERE 
AND IN THE CONTENTS.</EM></P>

<P>Many forms pass along the last value in their body, rather than 
creating a new value.  Examples include the bodies of <CODE>LET</CODE>, 
<CODE>COND</CODE>, <CODE>DEFUN</CODE>, and <CODE>LAMBDA</CODE>.</P>

<PRE WIDTH=80><IMG SRC="gifs/circle-dot.gif" ALT="?" ALIGN="BOTTOM"> (let ((a 1)
        (b 2))
     (values a b))
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> 1
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> 2

<IMG SRC="gifs/circle-dot.gif" ALT="?" ALIGN="BOTTOM"> (cond (nil 97)
        (t (values 3 4)))
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> 3
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> 4

<IMG SRC="gifs/circle-dot.gif" ALT="?" ALIGN="BOTTOM"> (defun foo (p q)
     (values (list :p p) (list :q q)))
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> FOO

<IMG SRC="gifs/circle-dot.gif" ALT="?" ALIGN="BOTTOM"> (foo 5 6)
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> (:P 5)
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> (:Q 6)

<IMG SRC="gifs/circle-dot.gif" ALT="?" ALIGN="BOTTOM"> ((lambda (r s)
      (values r s))
     7 8)
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> 7
<IMG SRC="gifs/right-arrow.gif" ALT="-&gt;" ALIGN="BOTTOM"> 8</PRE>


<BLOCKQUOTE>
<P>In the case of the function and lambda bodies, the multiple values are 
actually returned by something called an "<EM>implicit</EM> 
<CODE>PROGN</CODE>."  This is a fancy way of saying that the bodies can 
contain multiple forms, and only the value of the last form is returned.</P>

<P>You can use the <CODE>PROGN</CODE> special form when you want this behavior.  
<CODE>(PROGN form1 form2 ... formN)</CODE> evaluates <CODE>form1</CODE> 
through <CODE>formN</CODE> in order, and returns the value of 
<CODE>formN</CODE>.</P>
</BLOCKQUOTE>


<hr>
<a href="contents.html">Contents</a> | <a href="cover.html">Cover</a> <br> 
<a href="chapter02.html">Chapter 2</a> | 
<a href="chapter04.html">Chapter 4</a> | 
<A HREF="chapter03-08.html">Chapter 3, Lesson 8</A> | 
<A HREF="chapter03-10.html">Chapter 3, Lesson 10</A> | 
<A HREF="chapter03.html">Chapter 3, Introduction</A>
<hr>
<address>
Copyright &copy; 1995-1999, David B. Lamkins<br>
All Rights Reserved Worldwide<br>
<br>
This book may not be reproduced without the written consent of its 
author.  Online distribution is restricted to the author's site.
</address> 
</body> </html> 